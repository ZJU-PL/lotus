#ifndef CHECKER_GVFA_GVFAVULNERABILITYCHECKER_H
#define CHECKER_GVFA_GVFAVULNERABILITYCHECKER_H

#include <map>
#include <set>
#include <string>

#include <llvm/IR/Module.h>
#include <llvm/IR/Value.h>

using namespace llvm;

// Forward declarations
class DyckGlobalValueFlowAnalysis;

// Vulnerability source/sink types
using ValueSitePairType = std::pair<const Value *, int>;
using VulnerabilitySourcesType = std::map<ValueSitePairType, int>;
using VulnerabilitySinksType = std::map<const Value *, std::set<const Value *> *>;

/**
 * Base vulnerability checker interface
 * 
 * This interface defines the contract for vulnerability checkers that identify
 * sources and sinks for different types of vulnerabilities. Each checker
 * implements domain-specific logic for detecting potential security issues.
 */
class GVFAVulnerabilityChecker {
protected:
    DyckGlobalValueFlowAnalysis *GVFA = nullptr;
    
public:
    virtual ~GVFAVulnerabilityChecker() = default;
    
    /// Get vulnerability sources from the module
    virtual void getSources(Module *M, VulnerabilitySourcesType &Sources) = 0;
    
    /// Get vulnerability sinks from the module  
    virtual void getSinks(Module *M, VulnerabilitySinksType &Sinks) = 0;
    
    /// Check if a value transfer is valid for this vulnerability type
    virtual bool isValidTransfer(const Value *From, const Value *To) const = 0;
    
    /// Get vulnerability category
    virtual std::string getCategory() const = 0;
    
    /// Register bug type with BugReportMgr and return bug type ID
    virtual int registerBugType() = 0;
    
    /// Report a vulnerability to BugReportMgr
    virtual void reportVulnerability(int bugTypeId, const Value *Source, 
                                      const Value *Sink, 
                                      const std::set<const Value *> *SinkInsts) = 0;
    
    /// High-level detection method: run analysis and report all vulnerabilities
    /// Returns the number of vulnerabilities detected
    virtual int detectAndReport(Module *M, DyckGlobalValueFlowAnalysis *GVFA, 
                                bool contextSensitive = false, 
                                bool verbose = false) = 0;
};

#endif // CHECKER_GVFA_GVFAVULNERABILITYCHECKER_H

