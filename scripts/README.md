# Clam Python Scripts and Utilities

This directory contains Python scripts for running and analyzing Clam abstract interpreter results.

## Main Scripts

### clam.py
The main entry point for running Clam abstract interpreter on LLVM bitcode files.

**Usage:**
```bash
clam.py [OPTIONS] FILE
```

**Key Features:**
- Compiles C/C++ files to LLVM bitcode using Clang
- Runs LLVM optimization passes
- Performs abstract interpretation using Crab
- Supports various abstract domains (intervals, zones, octagons, polyhedra, etc.)
- Inter-procedural and intra-procedural analysis
- Memory tracking and pointer analysis via Sea-DSA
- Property checking (assertions, null dereferences, buffer overflows, use-after-free)

**Common Options:**
- `-g`: Compile with debug information
- `-O [0-3]`: LLVM optimization level
- `--crab-inter`: Enable inter-procedural analysis
- `--crab-track [num|sing-mem|mem]`: Track integers, singleton memory, or all memory
- `--crab-dom [DOMAIN]`: Choose abstract domain (e.g., zones, oct, pk)
- `--crab-check [CHECK]`: Enable property checking (assert, null, uaf, bounds)
- `--crab-heap-analysis [ANALYSIS]`: Heap analysis for memory disambiguation
- `--ocrab FILE`: Output CrabIR with invariants to file
- `--ojson FILE`: Output invariants to JSON format
- `--cpu SEC`: CPU time limit in seconds
- `--mem MB`: Memory limit in megabytes

**Example:**
```bash
clam.py -g test.c --crab-inter --crab-track=mem --crab-check=assert \
        --crab-heap-analysis=cs-sea-dsa-types --ocrab=test.crabir
```

### clam-yaml.py
YAML configuration interface for Clam. Allows running Clam with predefined configurations.

**Usage:**
```bash
clam-yaml.py -y CONFIG.yaml [OPTIONS] FILE
```

**Example:**
```bash
clam-yaml.py -y yaml-configurations/clam.inter.mem.yaml test.c
```

### stats.py
Statistics module for timing and resource usage tracking. Used internally by clam.py.

## Utility Scripts

### clam-read-results.py
Process a `.crabir` file generated by Clam's `--ocrab` option and print statistics about how many assertions were proven.

**Usage:**
```bash
clam.py prog.c --crab-check=assert --ocrab=prog.crabir [OPTIONS]
clam-read-results.py prog.crabir
```

**Options:**
- `--verbose NUM`: Verbosity level (0-3)

**Output:**
- Total number of checked assertions
- Total number of proven assertions
- Total number of failed assertions
- Ratio of proven assertions

### clam-debug-assertion.py
Slice a CrabIR program to show only relevant information for debugging a specific assertion.

**Usage:**
```bash
clam.py -g prog.c --crab-track=mem --crab-inter --crab-check=assert \
        --crab-print-invariants=true --crab-print-voi=true \
        --log=region-print-debug --ocrab=prog.crabir [OPTIONS]
clam-debug-assertion.py --assertion=NUM prog.crabir
```

**Required Options:**
- `--assertion NUM`: Numerical identifier of the assertion to debug

**Features:**
- Extracts variables-of-influence (VOI) for the assertion
- Slices invariants to show only relevant variables
- Creates a simplified view for debugging why an assertion failed

### clam-output-check.py
Check that a Clam run reports the expected number of safe, error, and warning checks. Useful for automated testing and tools like llvm-reduce.

**Usage:**
```bash
clam-output-check.py --file FILE -safe NUM -err NUM -warn NUM -- TOOL [TOOL_ARGS]
```

**Options:**
- `--file FILE`: LLVM program to analyze
- `-safe NUM`: Expected number of safe checks
- `-err NUM`: Expected number of error checks
- `-warn NUM`: Expected number of warning checks
- `--keep-files`: Keep temporary output files

**Returns:** 0 if expected counts match, 1 otherwise

### validate_npd.py
Validate null pointer dereference detection results. (Legacy script from original Lotus project)

## YAML Configuration Files

Pre-configured analysis settings are available in the `yaml-configurations/` directory:

- **clam.inter.mem.yaml**: Inter-procedural analysis with full memory tracking
- **clam.intra.mem.yaml**: Intra-procedural analysis with full memory tracking and aggressive inlining
- **clam.svcomp19.yaml**: Configuration for SV-COMP 2019 benchmarks



## Installation

When building the project with CMake, these scripts are automatically installed to the `bin/` directory:

```bash
cmake --build . --target install
```

The scripts will be available in your installation prefix's `bin/` directory.

